---
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';
import HeaderLink from './HeaderLink.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

// Basic language detection for current path
const currentPath = Astro.url.pathname;
const isEn = lang === 'en';
const isJa = lang === 'ja';

// Extract the slug from current path for language switching
let slug = currentPath;
if (currentPath.startsWith('/en/')) slug = currentPath.replace('/en/', '/');
if (currentPath.startsWith('/ja/')) slug = currentPath.replace('/ja/', '/');
if (slug === '/en') slug = '/';
if (slug === '/ja') slug = '/';
---

<header class="site-header">
	<nav class="nav">
		<div class="brand">
			<a class="logo" href={translatePath('/')}>{t('site.title')}</a>
			<span class="tagline">{t('site.tagline')}</span>
		</div>
		<div class="internal-links">
			<HeaderLink href={translatePath('/')}>{t('nav.home')}</HeaderLink>
			<HeaderLink href={translatePath('/blog')}>{t('nav.blog')}</HeaderLink>
			<HeaderLink href={translatePath('/about')}>{t('nav.about')}</HeaderLink>
			<HeaderLink href={translatePath('/privacy')}>{t('nav.privacy')}</HeaderLink>
		</div>
		<div class="social-links">
			<select class="lang-selector" onchange="window.location.href = this.value">
				<option value={slug} selected={!isEn && !isJa}>中文</option>
				<option value={`/en${slug === '/' ? '' : slug}`} selected={isEn}>English</option>
				<option value={`/ja${slug === '/' ? '' : slug}`} selected={isJa}>日本語</option>
			</select>
			<a class="icon-link" href="mailto:rainiee@gmail.com" aria-label="Email">
				<span class="sr-only">Email</span>
				<svg viewBox="0 0 24 24" aria-hidden="true" width="20" height="20">
					<path
						fill="currentColor"
						d="M4 5h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2zm0 2v.2l8 4.8 8-4.8V7H4zm16 10V9.3l-7.47 4.48a1 1 0 0 1-1.06 0L4 9.3V17h16z"
					></path>
				</svg>
			</a>
			<a
				class="icon-link"
				href="https://twitter.com/rainee0716"
				target="_blank"
				rel="noreferrer"
				aria-label="Twitter"
			>
				<span class="sr-only">Twitter</span>
				<svg viewBox="0 0 24 24" aria-hidden="true" width="20" height="20">
					<path
						fill="currentColor"
						d="M19.5 7.5c.01.14.01.29.01.44 0 4.5-3.43 9.7-9.7 9.7-1.93 0-3.72-.56-5.23-1.52.27.03.54.04.82.04 1.6 0 3.07-.55 4.25-1.46a3.42 3.42 0 0 1-3.19-2.38c.2.03.4.05.62.05.3 0 .6-.04.88-.12a3.42 3.42 0 0 1-2.74-3.35v-.04c.46.26.99.42 1.56.44a3.42 3.42 0 0 1-1.06-4.56 9.72 9.72 0 0 0 7.06 3.58 3.86 3.86 0 0 1-.09-.78 3.42 3.42 0 0 1 5.91-2.34 6.73 6.73 0 0 0 2.17-.83 3.41 3.41 0 0 1-1.5 1.89 6.78 6.78 0 0 0 1.96-.53 7.35 7.35 0 0 1-1.7 1.77z"
					></path>
				</svg>
			</a>
		</div>
	</nav>
</header>

<style>
	.site-header {
		position: sticky;
		top: 0;
		z-index: 10;
		background: rgba(255, 255, 255, 0.85);
		backdrop-filter: blur(14px);
		border-bottom: 1px solid var(--border);
	}

	.nav {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 1.5rem;
		margin: 0 auto;
		padding: 0.8rem 1.4rem;
		width: min(var(--page-max), 100%);
	}

	.brand {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
	}

	.logo {
		font-size: 1.1rem;
		font-weight: 700;
		color: var(--accent-strong);
	}

	.tagline {
		font-size: 0.75rem;
		letter-spacing: 0.2em;
		text-transform: uppercase;
		color: rgb(var(--ink-soft));
	}

	.internal-links {
		display: flex;
		align-items: center;
		gap: 0.9rem;
	}

	.internal-links a {
		padding: 0.4rem 0.6rem;
		border-radius: 999px;
		color: rgb(var(--ink));
		font-weight: 600;
		transition: background 0.2s var(--ease-out), color 0.2s var(--ease-out);
	}

	.internal-links a.active {
		background: rgba(15, 118, 110, 0.12);
		color: var(--accent-strong);
	}

	.social-links,
	.social-links a {
		display: flex;
		align-items: center;
		gap: 0.8rem;
		color: rgb(var(--ink-soft));
	}

	.lang-selector {
		padding: 0.4rem 0.6rem;
		border-radius: 6px;
		border: 1px solid var(--border);
		background: rgba(var(--surface), 0.8);
		color: rgb(var(--ink));
		font-size: 0.85rem;
		font-weight: 500;
		cursor: pointer;
		transition: all 0.2s var(--ease-out);
	}

	.lang-selector:hover {
		border-color: var(--accent-strong);
		background: rgba(var(--surface), 1);
	}

	.lang-selector:focus {
		outline: 2px solid var(--accent-strong);
		outline-offset: 2px;
	}

	.icon-link {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 34px;
		height: 34px;
		border-radius: 999px;
		border: 1px solid transparent;
		color: rgb(var(--ink-soft));
		transition:
			color 0.2s var(--ease-out),
			background 0.2s var(--ease-out),
			border-color 0.2s var(--ease-out);
	}

	.icon-link:hover {
		color: var(--accent-strong);
		background: rgba(15, 118, 110, 0.08);
		border-color: rgba(15, 118, 110, 0.2);
	}

	@media (max-width: 900px) {
		.nav {
			flex-wrap: wrap;
			justify-content: center;
		}

		.brand {
			align-items: center;
		}
	}

	@media (max-width: 720px) {
		.tagline {
			display: none;
		}

		.social-links {
			display: none;
		}
	}
</style>
