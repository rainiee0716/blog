---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
const isBlogPost = Astro.url.pathname.startsWith("/blog/");
const eyebrow = isBlogPost ? "文章" : "页面";
---

<html lang="zh-CN">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			main {
				width: min(var(--page-max), calc(100% - 2.5rem));
			}
			.post-shell {
				background: rgba(var(--surface), 0.92);
				border-radius: var(--radius-lg);
				padding: 2.5rem clamp(1.5rem, 3vw, 3rem);
				border: 1px solid var(--border);
				box-shadow: var(--shadow);
			}
			.post-header {
				text-align: left;
				margin-bottom: 2rem;
			}
			.post-meta {
				display: flex;
				gap: 1rem;
				align-items: center;
				color: rgb(var(--ink-soft));
				font-size: 0.9rem;
			}
			.post-hero {
				margin: 2rem 0;
			}
			.post-hero img {
				border-radius: var(--radius-lg);
				box-shadow: var(--shadow);
			}
			.prose {
				max-width: var(--content-max);
				margin: 0 auto;
				color: rgb(var(--ink));
				line-height: 1.95;
			}
			.prose :global(p) {
				margin-bottom: 2.2rem;
			}
			.prose :global(h2),
			.prose :global(h3) {
				margin-top: 3rem;
			}
			.prose :global(ul),
			.prose :global(ol) {
				margin-bottom: 2.2rem;
				padding-left: 1.5rem;
			}
			.prose :global(li) {
				margin-bottom: 0.8rem;
				line-height: 1.8;
			}
			.updated {
				font-style: italic;
			}
			@media (max-width: 720px) {
				.post-shell {
					padding: 2rem 1.4rem;
				}
				.post-meta {
					flex-direction: column;
					align-items: flex-start;
					gap: 0.4rem;
				}
			}
		</style>
	</head>

	<body>
		<Header />
		<main>
			<article class="post-shell reveal">
				<header class="post-header">
					<p class="eyebrow">{eyebrow}</p>
					<h1>{title}</h1>
					<p class="lead">{description}</p>
					<div class="post-meta">
						<span>发布于 <FormattedDate date={pubDate} /></span>
						{
							updatedDate && (
								<span class="updated">
									更新于 <FormattedDate date={updatedDate} />
								</span>
							)
						}
					</div>
				</header>
				{
					heroImage && (
						<div class="post-hero">
							<Image
								width={1200}
								height={640}
								src={heroImage}
								alt=""
							/>
						</div>
					)
				}
				<div class="prose">
					<slot />
				</div>
			</article>
		</main>
		<Footer />
	</body>
</html>
